<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Globe</title>

    <style type="text/css">
            html {height: 100%}
        body { margin: 0; overflow:hidden; height:100%}

            #viewerDiv {
                margin : auto auto;
                width: 100%;
                height: 100%;
                padding: 0;
                /*margin-top: 50vh;
                transform: translateY(-50%);*/
            }
            #menuDiv {position: absolute; top:0px; margin-left: 0px;}


        </style>
        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.1/dat.gui.min.js"></script>
    </head>
    <body>
        <div id="viewerDiv"></div>
        <script src="examples/GUI/GuiTools.js"></script>
        <script src="dist/itowns2.js"> </script>
        <script type="text/javascript">

            /* global itowns,document,GuiTools*/

            var positionOnGlobe = { longitude:2.3465, latitude: 48.88, altitude: 25000000};

            // iTowns namespace defined here
            var viewerDiv = document.getElementById('viewerDiv');
            var menuGlobe = new GuiTools(itowns.viewer,'menuDiv');
            itowns.viewer.createSceneGlobe(positionOnGlobe, viewerDiv);

            let wgs84TileLayer = {
                protocol: 'tile',
                id: 'wgs84'
            };

            var urlImageryLayers = [], urlElevationLayers = [];

            urlImageryLayers.push('examples/layers/JSONLayers/Ortho.json');
            urlImageryLayers.push('examples/layers/JSONLayers/OrthosCRS.json');
            urlImageryLayers.push('examples/layers/JSONLayers/ScanEX.json');
            urlImageryLayers.push('examples/layers/JSONLayers/Region.json');

            urlElevationLayers.push('examples/layers/JSONLayers/IGN_MNT.json');
            urlElevationLayers.push('examples/layers/JSONLayers/IGN_MNT_HIGHRES.json');



            itowns.viewer.addGeometryLayer(wgs84TileLayer);
            let imageryPromise = itowns.viewer.addImageryLayersFromJSONArray(urlImageryLayers);
            let elevationPromise = itowns.viewer.addElevationLayersFromJSONArray(urlElevationLayers);

            imageryPromise.then((layersColors) => menuGlobe.addImageryLayersGUI(layersColors));
            elevationPromise.then((layersElevations) => {menuGlobe.addElevationLayersGUI(layersElevations);});

            Promise.all([imageryPromise, elevationPromise]).then(() => itowns.viewer.init());

            itowns.viewer.addFeatureLayer({
                url       : "http://wxs.ign.fr/72hpsel8j8nhb5qgdh07gcyp/geoportail/wfs?",
                protocol  : 'wfs',
                version   : '2.0.0',
                id        : 'testwfs',
                title     : "BDTOPO_BDD_WLD_WGS84G:bati_remarquable,BDTOPO_BDD_WLD_WGS84G:bati_indifferencie",
                styleName : "",
                extractStyle : true,
                projection: "EPSG:4326",
                // min long, min lat, max long, max lat (lower et upper corners)
                bbox      : [-63.1533283, -21.3896308, 55.8366872, 51.1028253],
                ipr       : "IGN",
                type      : "bbox", //bbox //poly//styledPoly
                options: {
                    mimetype  : "json",
                    tileMatrixSet: 'WGS84G'
                }
            });

            //Feature layers used fot tests purpose
            itowns.viewer.addFeatureLayer({
                id          : 'testWfsPoint',
                protocol    : "wfs",
                url         : 'https://download.data.grandlyon.com/wfs/rdata?',
                title       : 'jcd_jcdecaux.jcdvelov',
                crs         : 'EPSG:4326',
                type        : 'point',
                version   : '2.0.0',
                options: {
                    mimetype  : "geojson",
                    tileMatrixSet: 'WGS84G'
                },
                params: {
                    color: {
                        property: 'availability',
                        testTab : ['Vert', 'Orange', 'Bleu', 'Gris'],
                        colorTab: [0x339933, 0xFF9900, 0x3399FF, 0x888888]
                    },
                    heightParam : 'pop_rank',
                    nbSegment   : 8
                }
            });

            itowns.viewer.addFeatureLayer({
                id          : 'testWfsLine',
                protocol    : "wfs",
                url         : 'https://download.data.grandlyon.com/wfs/rdata?',
                title       : 'tcl_sytral.tcllignemf',
                crs         : 'EPSG:4326',
                type        : 'line',
                version   : '2.0.0',
                options: {
                    mimetype  : "geojson",
                    tileMatrixSet: 'WGS84G'
                },
                params: {
                    color: {
                        property: 'ligne',
                        testTab : ['A', 'B', 'C', 'D', 'F1', 'F2'],
                        colorTab: [0x225599, 0x5599ff, 0x147845, 0xFF5577, 0xAAFF44, 0xD7F458]
                    }
                }
            });

            menuGlobe.addGUI('RealisticLighting',false,function(newValue) {itowns.viewer.setRealisticLightingOn(newValue);});

            itowns.viewer.addEventListener('globe-loaded', function() {
                console.log("Globe Loaded");
            });
        </script>
    </body>
</html>
